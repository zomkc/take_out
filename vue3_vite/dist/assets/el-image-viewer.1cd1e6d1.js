import{m as ge,g as q,d as _e}from"./index.b3fbc379.js";import{I as se,ag as me,ah as Le,ai as Ce,r as C,aj as Te,a2 as xe,G as T,u as oe,n as we,A as ye,o as x,m as le,d as p,w as O,q as E,p as w,B as e,R as ue,a5 as Se,k as S,$ as ze,j as P,P as ce,ak as Oe,al as Ne,am as $e,an as Ae,Q as Re,ao as Be,ap as Me,ac as De,b as Ve,v as Fe,J as ne,T as Pe,aq as We,a1 as Xe,K as Ye,i as He,l as je}from"./index.7da13a9a.js";import{A as qe,B as ae,C as Ze,i as B,g as Ge,c as he,e as fe,h as de,u as ke,E as F,_ as be,D as Ke,w as Ie,k as Ue,F as Je}from"./base.c25e0513.js";import{u as Ee}from"./index.6b881f85.js";import{u as Qe,E as j}from"./index.03900eea.js";var et=/\s/;function tt(t){for(var r=t.length;r--&&et.test(t.charAt(r)););return r}var nt=/^\s+/;function at(t){return t&&t.slice(0,tt(t)+1).replace(nt,"")}var ve=0/0,st=/^[-+]0x[0-9a-f]+$/i,rt=/^0b[01]+$/i,it=/^0o[0-7]+$/i,ot=parseInt;function pe(t){if(typeof t=="number")return t;if(qe(t))return ve;if(ae(t)){var r=typeof t.valueOf=="function"?t.valueOf():t;t=ae(r)?r+"":r}if(typeof t!="string")return t===0?t:+t;t=at(t);var s=rt.test(t);return s||it.test(t)?ot(t.slice(2),s?2:8):st.test(t)?ve:+t}var lt=function(){return Ze.Date.now()};const re=lt;var ut="Expected a function",ct=Math.max,ft=Math.min;function dt(t,r,s){var i,m,y,z,o,h,v=0,k=!1,b=!1,g=!0;if(typeof t!="function")throw new TypeError(ut);r=pe(r)||0,ae(s)&&(k=!!s.leading,b="maxWait"in s,y=b?ct(pe(s.maxWait)||0,r):y,g="trailing"in s?!!s.trailing:g);function f(u){var I=i,$=m;return i=m=void 0,v=u,z=t.apply($,I),z}function M(u){return v=u,o=setTimeout(N,r),k?f(u):z}function d(u){var I=u-h,$=u-v,Y=r-I;return b?ft(Y,y-$):Y}function D(u){var I=u-h,$=u-v;return h===void 0||I>=r||I<0||b&&$>=y}function N(){var u=re();if(D(u))return W(u);o=setTimeout(N,d(u))}function W(u){return o=void 0,g&&i?f(u):(i=m=void 0,z)}function X(){o!==void 0&&clearTimeout(o),v=0,i=h=m=o=void 0}function Z(){return o===void 0?z:W(re())}function V(){var u=re(),I=D(u);if(i=arguments,m=this,h=u,I){if(o===void 0)return M(h);if(b)return clearTimeout(o),o=setTimeout(N,r),f(h)}return o===void 0&&(o=setTimeout(N,r)),z}return V.cancel=X,V.flush=Z,V}var mt="Expected a function";function ie(t,r,s){var i=!0,m=!0;if(typeof t!="function")throw new TypeError(mt);return ae(s)&&(i="leading"in s?!!s.leading:i,m="trailing"in s?!!s.trailing:m),dt(t,r,{leading:i,maxWait:r,trailing:m})}const vt=(t,r)=>{if(!B||!t||!r)return!1;const s=t.getBoundingClientRect();let i;return r instanceof Element?i=r.getBoundingClientRect():i={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},s.top<i.bottom&&s.bottom>i.top&&s.right>i.left&&s.left<i.right},pt=(t,r)=>{if(!B)return!1;const s={undefined:"overflow",true:"overflow-y",false:"overflow-x"}[String(r)],i=Ge(t,s);return["scroll","auto","overlay"].some(m=>i.includes(m))},gt=(t,r)=>{if(!B)return;let s=t;for(;s;){if([window,document,document.documentElement].includes(s))return window;if(pt(s,r))return s;s=s.parentNode}return s},wt=()=>B&&/firefox/i.test(window.navigator.userAgent),yt=he({urlList:{type:fe(Array),default:()=>ge([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:{type:Boolean,default:!1},teleported:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0}}),ht={close:()=>!0,switch:t=>de(t)},kt=["src"],bt=se({name:"ElImageViewer"}),It=se({...bt,props:yt,emits:ht,setup(t,{expose:r,emit:s}){const i=t,m={CONTAIN:{name:"contain",icon:me(Le)},ORIGINAL:{name:"original",icon:me(Ce)}},y=wt()?"DOMMouseScroll":"mousewheel",{t:z}=Ee(),o=ke("image-viewer"),{nextZIndex:h}=Qe(),v=C(),k=C([]),b=Te(),g=C(!0),f=C(i.initialIndex),M=xe(m.CONTAIN),d=C({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),D=T(()=>{const{urlList:n}=i;return n.length<=1}),N=T(()=>f.value===0),W=T(()=>f.value===i.urlList.length-1),X=T(()=>i.urlList[f.value]),Z=T(()=>{const{scale:n,deg:l,offsetX:c,offsetY:_,enableTransition:A}=d.value;let L=c/n,R=_/n;switch(l%360){case 90:case-270:[L,R]=[R,-L];break;case 180:case-180:[L,R]=[-L,-R];break;case 270:case-90:[L,R]=[-R,L];break}const H={transform:`scale(${n}) rotate(${l}deg) translate(${L}px, ${R}px)`,transition:A?"transform .3s":""};return M.value.name===m.CONTAIN.name&&(H.maxWidth=H.maxHeight="100%"),H}),V=T(()=>de(i.zIndex)?i.zIndex:h());function u(){$(),s("close")}function I(){const n=ie(c=>{switch(c.code){case j.esc:i.closeOnPressEscape&&u();break;case j.space:Q();break;case j.left:ee();break;case j.up:a("zoomIn");break;case j.right:te();break;case j.down:a("zoomOut");break}}),l=ie(c=>{(c.wheelDelta?c.wheelDelta:-c.detail)>0?a("zoomIn",{zoomRate:1.2,enableTransition:!1}):a("zoomOut",{zoomRate:1.2,enableTransition:!1})});b.run(()=>{q(document,"keydown",n),q(document,y,l)})}function $(){b.stop()}function Y(){g.value=!1}function U(n){g.value=!1,n.target.alt=z("el.image.error")}function J(n){if(g.value||n.button!==0||!v.value)return;d.value.enableTransition=!1;const{offsetX:l,offsetY:c}=d.value,_=n.pageX,A=n.pageY,L=ie(H=>{d.value={...d.value,offsetX:l+H.pageX-_,offsetY:c+H.pageY-A}}),R=q(document,"mousemove",L);q(document,"mouseup",()=>{R()}),n.preventDefault()}function G(){d.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function Q(){if(g.value)return;const n=Ke(m),l=Object.values(m),c=M.value.name,A=(l.findIndex(L=>L.name===c)+1)%n.length;M.value=m[n[A]],G()}function K(n){const l=i.urlList.length;f.value=(n+l)%l}function ee(){N.value&&!i.infinite||K(f.value-1)}function te(){W.value&&!i.infinite||K(f.value+1)}function a(n,l={}){if(g.value)return;const{zoomRate:c,rotateDeg:_,enableTransition:A}={zoomRate:1.4,rotateDeg:90,enableTransition:!0,...l};switch(n){case"zoomOut":d.value.scale>.2&&(d.value.scale=Number.parseFloat((d.value.scale/c).toFixed(3)));break;case"zoomIn":d.value.scale<7&&(d.value.scale=Number.parseFloat((d.value.scale*c).toFixed(3)));break;case"clockwise":d.value.deg+=_;break;case"anticlockwise":d.value.deg-=_;break}d.value.enableTransition=A}return oe(X,()=>{we(()=>{const n=k.value[0];n!=null&&n.complete||(g.value=!0)})}),oe(f,n=>{G(),s("switch",n)}),ye(()=>{var n,l;I(),(l=(n=v.value)==null?void 0:n.focus)==null||l.call(n)}),r({setActiveItem:K}),(n,l)=>(x(),le(We,{to:"body",disabled:!n.teleported},[p(Pe,{name:"viewer-fade",appear:""},{default:O(()=>[E("div",{ref_key:"wrapper",ref:v,tabindex:-1,class:w(e(o).e("wrapper")),style:ue({zIndex:e(V)})},[E("div",{class:w(e(o).e("mask")),onClick:l[0]||(l[0]=Se(c=>n.hideOnClickModal&&u(),["self"]))},null,2),S(" CLOSE "),E("span",{class:w([e(o).e("btn"),e(o).e("close")]),onClick:u},[p(e(F),null,{default:O(()=>[p(e(ze))]),_:1})],2),S(" ARROW "),e(D)?S("v-if",!0):(x(),P(ce,{key:0},[E("span",{class:w([e(o).e("btn"),e(o).e("prev"),e(o).is("disabled",!n.infinite&&e(N))]),onClick:ee},[p(e(F),null,{default:O(()=>[p(e(Oe))]),_:1})],2),E("span",{class:w([e(o).e("btn"),e(o).e("next"),e(o).is("disabled",!n.infinite&&e(W))]),onClick:te},[p(e(F),null,{default:O(()=>[p(e(Ne))]),_:1})],2)],64)),S(" ACTIONS "),E("div",{class:w([e(o).e("btn"),e(o).e("actions")])},[E("div",{class:w(e(o).e("actions__inner"))},[p(e(F),{onClick:l[1]||(l[1]=c=>a("zoomOut"))},{default:O(()=>[p(e($e))]),_:1}),p(e(F),{onClick:l[2]||(l[2]=c=>a("zoomIn"))},{default:O(()=>[p(e(Ae))]),_:1}),E("i",{class:w(e(o).e("actions__divider"))},null,2),p(e(F),{onClick:Q},{default:O(()=>[(x(),le(Re(e(M).icon)))]),_:1}),E("i",{class:w(e(o).e("actions__divider"))},null,2),p(e(F),{onClick:l[3]||(l[3]=c=>a("anticlockwise"))},{default:O(()=>[p(e(Be))]),_:1}),p(e(F),{onClick:l[4]||(l[4]=c=>a("clockwise"))},{default:O(()=>[p(e(Me))]),_:1})],2)],2),S(" CANVAS "),E("div",{class:w(e(o).e("canvas"))},[(x(!0),P(ce,null,De(n.urlList,(c,_)=>Ve((x(),P("img",{ref_for:!0,ref:A=>k.value[_]=A,key:c,src:c,style:ue(e(Z)),class:w(e(o).e("img")),onLoad:Y,onError:U,onMousedown:J},null,46,kt)),[[Fe,_===f.value]])),128))],2),ne(n.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var Et=be(It,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const _t=Ie(Et),Lt=he({hideOnClickModal:{type:Boolean,default:!1},src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:{type:Boolean,default:!1},scrollContainer:{type:fe([String,Object])},previewSrcList:{type:fe(Array),default:()=>ge([])},previewTeleported:{type:Boolean,default:!1},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0}}),Ct={load:t=>t instanceof Event,error:t=>t instanceof Event,switch:t=>de(t),close:()=>!0,show:()=>!0},Tt=["src","loading"],xt={key:0},St=se({name:"ElImage",inheritAttrs:!1}),zt=se({...St,props:Lt,emits:Ct,setup(t,{emit:r}){const s=t;let i="";const{t:m}=Ee(),y=ke("image"),z=Xe(),o=_e(),h=C(),v=C(!1),k=C(!0),b=C(!1),g=C(),f=C(),M=B&&"loading"in HTMLImageElement.prototype;let d,D;const N=T(()=>z.style),W=T(()=>{const{fit:a}=s;return B&&a?{objectFit:a}:{}}),X=T(()=>{const{previewSrcList:a}=s;return Array.isArray(a)&&a.length>0}),Z=T(()=>{const{previewSrcList:a,initialIndex:n}=s;let l=n;return n>a.length-1&&(l=0),l}),V=T(()=>s.loading==="eager"?!1:!M&&s.loading==="lazy"||s.lazy),u=()=>{!B||(k.value=!0,v.value=!1,h.value=s.src)};function I(a){k.value=!1,v.value=!1,r("load",a)}function $(a){k.value=!1,v.value=!0,r("error",a)}function Y(){vt(g.value,f.value)&&(u(),G())}const U=Je(Y,200);async function J(){var a;if(!B)return;await we();const{scrollContainer:n}=s;Ue(n)?f.value=n:He(n)&&n!==""?f.value=(a=document.querySelector(n))!=null?a:void 0:g.value&&(f.value=gt(g.value)),f.value&&(d=q(f,"scroll",U),setTimeout(()=>Y(),100))}function G(){!B||!f.value||!U||(d==null||d(),f.value=void 0)}function Q(a){if(!!a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}function K(){!X.value||(D=q("wheel",Q,{passive:!1}),i=document.body.style.overflow,document.body.style.overflow="hidden",b.value=!0,r("show"))}function ee(){D==null||D(),document.body.style.overflow=i,b.value=!1,r("close")}function te(a){r("switch",a)}return oe(()=>s.src,()=>{V.value?(k.value=!0,v.value=!1,G(),J()):u()}),ye(()=>{V.value?J():u()}),(a,n)=>(x(),P("div",{ref_key:"container",ref:g,class:w([e(y).b(),a.$attrs.class]),style:ue(e(N))},[h.value!==void 0&&!v.value?(x(),P("img",Ye({key:0},e(o),{src:h.value,loading:a.loading,style:e(W),class:[e(y).e("inner"),e(X)&&e(y).e("preview"),k.value&&e(y).is("loading")],onClick:K,onLoad:I,onError:$}),null,16,Tt)):S("v-if",!0),k.value||v.value?(x(),P("div",{key:1,class:w(e(y).e("wrapper"))},[k.value?ne(a.$slots,"placeholder",{key:0},()=>[E("div",{class:w(e(y).e("placeholder"))},null,2)]):v.value?ne(a.$slots,"error",{key:1},()=>[E("div",{class:w(e(y).e("error"))},je(e(m)("el.image.error")),3)]):S("v-if",!0)],2)):S("v-if",!0),e(X)?(x(),P(ce,{key:2},[b.value?(x(),le(e(_t),{key:0,"z-index":a.zIndex,"initial-index":e(Z),infinite:a.infinite,"url-list":a.previewSrcList,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:ee,onSwitch:te},{default:O(()=>[a.$slots.viewer?(x(),P("div",xt,[ne(a.$slots,"viewer")])):S("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):S("v-if",!0)],64)):S("v-if",!0)],6))}});var Ot=be(zt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const Mt=Ie(Ot);export{Mt as E};
