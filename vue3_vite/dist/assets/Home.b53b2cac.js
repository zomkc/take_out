import"./base.c25e0513.js";import{E as U}from"./el-image-viewer.1cd1e6d1.js";import{c as T,a as A,d as V,s as R,b as S,u as M,e as B,i as x,f as q,_ as k}from"./noImg.824154f6.js";import{_ as O,ab as N,o as d,j as n,q as a,P as m,ac as _,p as D,l as r,k as g,d as f,w as u,m as P,ad as j,a5 as F,s as b,ae as z,af as H}from"./index.7da13a9a.js";import{E as G}from"./index.b3fbc379.js";import"./index.6b881f85.js";import"./index.03900eea.js";const J=""+new URL("../images/user.png",import.meta.url).href,K=""+new URL("../images/favico.jpg",import.meta.url).href,Q=""+new URL("../images/time.png",import.meta.url).href,W=""+new URL("../images/money.png",import.meta.url).href,X=""+new URL("../images/location.png",import.meta.url).href,y=""+new URL("../images/subtract.png",import.meta.url).href,w=""+new URL("../images/add.png",import.meta.url).href,L=""+new URL("../images/close.png",import.meta.url).href;const Y={components:{ElConfigProvider:G},data(){return{activeType:0,categoryList:[],categoryId:void 0,dishList:[],cartData:[],dialogFlavor:{name:"",flavors:[],dishId:void 0,price:void 0,show:!1,image:""},cartDialogShow:!1,detailsDialog:{show:!1,item:{image:""}},setMealDialog:{show:!1,item:{}}}},computed:{goodsNum(){let s=0;return this.cartData.forEach(e=>{s+=e.number}),s<99?s:"99+"},goodsPrice(){let s=0;return this.cartData.forEach(e=>{s+=e.number*e.amount}),s}},watch:{"dialogFlavor.show"(s){s?document.querySelector(".divCart").style.zIndex=1:document.querySelector(".divCart").style.zIndex=3e3}},mounted(){this.initData()},methods:{initData(){Promise.all([T(),A({userId:sessionStorage.getItem("userId")})]).then(s=>{s[0].data.code===1?(this.categoryList=s[0].data.data,Array.isArray(s[0].data.data)&&s[0].data.data.length>0&&(this.categoryId=s[0].data.data[0].id,s[0].data.data[0].type===1?this.getDishList():this.getSetmealData())):console.log(s.data.console.error),s[1].data.code===1?this.cartData=s[1].data.data:console.log(s.data.console.error)})},categoryClick(s,e,o){this.activeType=s,this.categoryId=e,o===1?this.getDishList():this.getSetmealData()},async getDishList(){if(!this.categoryId)return;const s=await V({categoryId:this.categoryId,status:1});if(s.data.code===1){let e=s.data.data;const o=this.cartData;e.length>0&&o.length>0&&e.forEach(c=>{o.forEach(i=>{c.id===i.dishId&&(c.number=i.number)})}),this.dishList=e}else console.log(s.data.console.error)},async getSetmealData(){if(!this.categoryId)return;const s=await R({categoryId:this.categoryId,status:1});if(s.data.code===1){let e=s.data.data;const o=this.cartData;e.length>0&&o.length>0&&e.forEach(c=>{o.forEach(i=>{c.id===i.setmealId&&(c.number=i.number)})}),this.dishList=e}else console.log(s.data.console.error)},async getCartData(){const s=await A({userId:sessionStorage.getItem("userId")});s.data.code===1?this.cartData=s.data.data:console.log(s.data.console.error)},async addCart(s){let e={amount:s.price/100,dishFlavor:s.dishFlavor,dishId:void 0,setmealId:void 0,name:s.name,image:s.image,userId:sessionStorage.getItem("userId")};Array.isArray(s.flavors)?e.dishId=s.id:e.setmealId=s.id;const o=await S(e);o.data.code===1?(this.dishList.forEach(c=>{c.id===s.id&&(c.number=o.data.data.number)}),this.setMealDialog.show&&(s.number=o.data.data.number),this.getCartData()):console.log(o.data.console.error)},async subtractCart(s){let e={dishId:s.id};Array.isArray(s.flavors)||(e={setmealId:s.id});const o=await M(e);o.data.code===1?(this.dishList.forEach(c=>{c.id===s.id&&(c.number=o.data.number===0?void 0:o.data.data.number)}),this.setMealDialog.show&&(s.number=o.data.data.number===0?void 0:o.data.data.number),this.getCartData()):console.log(o.data.console.error)},openCart(){this.cartData.length>0&&(this.cartDialogShow=!0)},async cartNumAdd(s){let e={amount:s.amount,dishFlavor:s.dishFlavor,dishId:s.dishId,setmealId:s.setmealId,name:s.name,image:s.image,userId:sessionStorage.getItem("userId")};const o=await S(e);o.data.code===1?(this.dishList.forEach(c=>{c.id===(s.dishId||s.setmealId)&&(c.number=o.data.data.number)}),console.log(this.dishList),this.getCartData()):console.log(o.data.console.error)},async cartNumberSubtract(s){let e={dishId:s.dishId,setmealId:s.setmealId};const o=await M(e);o.data.code===1?(this.dishList.forEach(c=>{c.id===(s.dishId||s.setmealId)&&(c.number=o.data.data.number===0?void 0:o.data.data.number)}),this.getCartData()):console.log(o.data.console.error)},changeDishList(s){for(let e of this.dishList)e.id===(s.setmealId||s.dishId)&&(e.number=s.number)},async clearCart(){const s=await B({userId:sessionStorage.getItem("userId")});if(s.data.code===1){for(let e of this.dishList)e.number=void 0;this.cartData=[],this.cartDialogShow=!1}else console.log(s.data.console.error)},chooseFlavorClick(s){this.dialogFlavor={name:"",flavors:[],dishId:void 0,price:void 0,show:!1},this.dialogFlavor={name:s.name,flavors:s.flavors,dishId:s.id,price:s.price,show:!0,image:s.image}},flavorClick(s,e){s.dishFlavor=e,this.dialogFlavor.show=!1,this.dialogFlavor.show=!0},dialogFlavorAddCart(){const s=this.dialogFlavor;let e=!0,o=[];s.flavors!=null&&s.flavors.forEach(c=>{c.dishFlavor?o.push(c.dishFlavor):(e=!1,console.log(res.data.console.error))}),e&&(this.addCart({price:s.price,dishFlavor:o.join(","),id:s.dishId,flavors:[],image:s.image,name:s.name}),this.dialogFlavor.show=!1)},imgPathConvert(s){return x(s)},toAddOrderPage(){this.cartData.length>0&&window.requestAnimationFrame(()=>{this.$router.push("/addorder")})},toUserPage(){window.requestAnimationFrame(()=>{this.$router.push("/user")})},async dishDetails(s){if(this.detailsDialog.item={},this.setMealDialog.item={},Array.isArray(s.flavors))this.detailsDialog.item=s,this.detailsDialog.show=!0;else{const e=await q(s.id);e.data.code===1?(this.setMealDialog.item={...s,list:e.data.data},this.setMealDialog.show=!0):console.log(e.data.console.error)}}}},v=s=>(z("data-v-ba49230a"),s=s(),H(),s),Z={id:"main",class:"app"},$={class:"divHead"},ss=j('<div class="divTitle" data-v-ba49230a><div class="divStatic" data-v-ba49230a><img src="'+K+'" class="logo" data-v-ba49230a><div class="divDesc" data-v-ba49230a><div class="divName" data-v-ba49230a>\u53EA\u56E0</div><div class="divSend" data-v-ba49230a><span data-v-ba49230a><img src="'+Q+'" data-v-ba49230a> \u8DDD\u79BB1.5km</span><span data-v-ba49230a><img src="'+W+'" data-v-ba49230a> \u914D\u9001\u8D396\u5143</span><span data-v-ba49230a><img src="'+X+'" data-v-ba49230a> \u9884\u8BA1\u65F6\u957F12min</span></div></div></div><div class="divDesc" data-v-ba49230a> \u7B80\u4ECB: \u53EA\u56E0\u70B8\u9E21\u5E97\u662F\u53EA\u56E0\u70B9\u9910\u7684\u72EC\u7ACB\u7684\u54C1\u724C\uFF0C\u5B9A\u4F4D\u201C\u5927\u4F17 \u5316\u7684\u7F8E\u98DF\u5916\u9001\u9910\u996E\u201D\uFF0C\u65E8\u4E3A\u987E\u5BA2\u6253\u9020\u4E13\u4E1A\u7F8E\u98DF\u3002 </div></div>',1),as={class:"divBody"},es={class:"divType"},ts=["onClick"],is={class:"divMenu"},os=["onClick"],ls=v(()=>a("div",{slot:"error",class:"image-slot"},[a("img",{src:k})],-1)),ds={class:"divName"},rs={class:"divDesc"},ns={class:"divDesc"},cs={class:"divBottom"},vs=v(()=>a("span",null,"\uFFE5",-1)),hs={class:"divNum"},gs={key:0,class:"divSubtract"},us=["onClick"],ms={class:"divDishNum"},_s=["onClick"],fs={key:2,class:"divAdd"},ps=["onClick"],Ds=v(()=>a("div",{class:"divLayer"},[a("div",{class:"divLayerLeft"}),a("div",{class:"divLayerRight"})],-1)),Cs={key:0,class:"divCart"},bs={class:"divNum"},ys=v(()=>a("span",null,"\uFFE5",-1)),ws=v(()=>a("div",{class:"divPrice"},null,-1)),ks={class:"divContent"},Is={class:"divFlavorTitle"},Fs=["onClick"],Ls={class:"divBottom"},As=v(()=>a("span",{class:"spanMoney"},"\uFFE5",-1)),Ss=v(()=>a("img",{src:L},null,-1)),Ms=[Ss],Ns={class:"divCartTitle"},Ps=v(()=>a("div",{class:"title"},"\u8D2D\u7269\u8F66",-1)),Es=v(()=>a("i",{class:"el-icon-delete"},null,-1)),Us={class:"divCartContent"},Ts=v(()=>a("div",{slot:"error",class:"image-slot"},[a("img",{src:k})],-1)),Vs={class:"divDesc"},Rs={class:"name"},Bs={class:"price"},xs=v(()=>a("span",{class:"spanMoney"},"\uFFE5",-1)),qs={class:"flavor"},Os={class:"divNum"},js={class:"divSubtract"},zs=["onClick"],Hs={class:"divDishNum"},Gs={class:"divAdd"},Js=["onClick"],Ks=v(()=>a("div",{class:"divSplit"},null,-1)),Qs={class:"divContainer"},Ws=v(()=>a("div",{slot:"error",class:"image-slot"},[a("img",{src:k})],-1)),Xs={class:"title"},Ys={class:"content"},Zs={class:"divNum"},$s={class:"left"},sa=v(()=>a("span",null,"\uFFE5",-1)),aa={class:"right"},ea={key:0,class:"divSubtract"},ta={class:"divDishNum"},ia={key:2,class:"divAdd"},oa=v(()=>a("img",{src:L},null,-1)),la=[oa],da={class:"divContainer"},ra={class:"title"},na=v(()=>a("div",{slot:"error",class:"image-slot"},[a("img",{src:k})],-1)),ca={class:"divSubTitle"},va={class:"divPrice"},ha=v(()=>a("span",null,"\uFFE5",-1)),ga={class:"content"},ua={class:"divNum"},ma={class:"left"},_a=v(()=>a("span",null,"\uFFE5",-1)),fa={class:"right"},pa={key:0,class:"divSubtract"},Da={class:"divDishNum"},Ca={key:1,class:"divAdd"},ba=v(()=>a("img",{src:L},null,-1)),ya=[ba];function wa(s,e,o,c,i,l){const C=U,I=N("van-dialog"),E=N("van-popup");return d(),n("div",Z,[a("div",$,[a("img",{src:J,onClick:e[0]||(e[0]=(...t)=>l.toUserPage&&l.toUserPage(...t))})]),ss,a("div",as,[a("div",es,[a("ul",null,[(d(!0),n(m,null,_(i.categoryList,(t,h)=>(d(),n("li",{key:h,onClick:p=>l.categoryClick(h,t.id,t.type),class:D({active:i.activeType===h})},r(t.name),11,ts))),128))])]),a("div",is,[a("div",null,[(d(!0),n(m,null,_(i.dishList,(t,h)=>(d(),n("div",{class:"divItem",key:h,onClick:p=>l.dishDetails(t)},[f(C,{src:l.imgPathConvert(t.image)},{default:u(()=>[ls]),_:2},1032,["src"]),a("div",null,[a("div",ds,r(t.name),1),a("div",rs,r(t.description),1),a("div",ns,r("\u6708\u9500"+(t.saleNum?t.saleNum:0)),1),a("div",cs,[vs,a("span",null,r(t.price/100),1)]),a("div",hs,[t.number>0?(d(),n("div",gs,[a("img",{src:y,onClick:F(p=>l.subtractCart(t),["prevent","stop"])},null,8,us)])):g("",!0),a("div",ms,r(t.number),1),t.flavors&&t.flavors.length>0&&!t.number?(d(),n("div",{key:1,class:"divTypes",onClick:F(p=>l.chooseFlavorClick(t),["prevent","stop"])},"\u9009\u62E9\u89C4\u683C ",8,_s)):(d(),n("div",fs,[a("img",{src:w,onClick:F(p=>l.addCart(t),["prevent","stop"])},null,8,ps)]))])])],8,os))),128))])])]),Ds,i.categoryList.length>0?(d(),n("div",Cs,[a("div",{class:D({imgCartActive:i.cartData&&i.cartData.length>0,imgCart:!i.cartData||i.cartData.length<1}),onClick:e[1]||(e[1]=(...t)=>l.openCart&&l.openCart(...t))},null,2),i.cartData&&i.cartData.length>0?(d(),n("div",{key:0,class:D({divGoodsNum:!0,moreGoods:i.cartData&&i.cartData.length>99})},r(l.goodsNum),3)):g("",!0),a("div",bs,[ys,a("span",null,r(l.goodsPrice),1)]),ws,a("div",{class:D({btnSubmitActive:i.cartData&&i.cartData.length>0,btnSubmit:!i.cartData||i.cartData.length<1}),onClick:e[2]||(e[2]=(...t)=>l.toAddOrderPage&&l.toAddOrderPage(...t))},"\u53BB\u7ED3\u7B97 ",2)])):g("",!0),f(I,{show:i.dialogFlavor.show,"onUpdate:show":e[5]||(e[5]=t=>i.dialogFlavor.show=t),title:i.dialogFlavor.name,"show-confirm-button":!1,class:"dialogFlavor"},{default:u(()=>[a("div",ks,[(d(!0),n(m,null,_(i.dialogFlavor.flavors,t=>(d(),n("div",{key:t.id},[a("div",Is,r(t.name),1),(d(!0),n(m,null,_(JSON.parse(t.value),h=>(d(),n("span",{key:h,onClick:p=>l.flavorClick(t,h),class:D({spanActive:t.dishFlavor===h})},r(h),11,Fs))),128))]))),128))]),a("div",Ls,[a("div",null,[As,b(r(i.dialogFlavor.price/100),1)]),a("div",{onClick:e[3]||(e[3]=(...t)=>l.dialogFlavorAddCart&&l.dialogFlavorAddCart(...t))},"\u52A0\u5165\u8D2D\u7269\u8F6622")]),a("div",{onClick:e[4]||(e[4]=t=>i.dialogFlavor.show=!1),class:"divFlavorClose"},Ms)]),_:1},8,["show","title"]),f(E,{show:i.cartDialogShow,"onUpdate:show":e[7]||(e[7]=t=>i.cartDialogShow=t),position:"bottom",style:{height:"50%"},class:"dialogCart"},{default:u(()=>[a("div",Ns,[Ps,a("div",{class:"clear",onClick:e[6]||(e[6]=(...t)=>l.clearCart&&l.clearCart(...t))},[Es,b(" \u6E05\u7A7A ")])]),a("div",Us,[(d(!0),n(m,null,_(i.cartData,t=>(d(),n("div",{key:t.id,class:"divCartItem"},[f(C,{src:l.imgPathConvert(t.image)},{default:u(()=>[Ts]),_:2},1032,["src"]),a("div",Vs,[a("div",Rs,r(t.name),1),a("div",Bs,[xs,b(r(t.amount),1)]),a("div",qs,r(t.dishFlavor),1)]),a("div",Os,[a("div",js,[a("img",{src:y,onClick:h=>l.cartNumberSubtract(t)},null,8,zs)]),a("div",Hs,r(t.number),1),a("div",Gs,[a("img",{src:w,onClick:h=>l.cartNumAdd(t)},null,8,Js)])]),Ks]))),128))])]),_:1},8,["show"]),i.detailsDialog.show?(d(),P(I,{key:1,modelValue:i.detailsDialog.show,"onUpdate:modelValue":e[12]||(e[12]=t=>i.detailsDialog.show=t),"show-confirm-button":!1,class:"detailsDialog",ref:"detailsDialog"},{default:u(()=>[a("div",Qs,[f(C,{src:l.imgPathConvert(i.detailsDialog.item.image)},{default:u(()=>[Ws]),_:1},8,["src"]),a("div",Xs,r(i.detailsDialog.item.name),1),a("div",Ys,r(i.detailsDialog.item.description),1)]),a("div",Zs,[a("div",$s,[sa,a("span",null,r(i.detailsDialog.item.price/100),1)]),a("div",aa,[i.detailsDialog.item.number>0?(d(),n("div",ea,[a("img",{src:y,onClick:e[8]||(e[8]=t=>l.subtractCart(i.detailsDialog.item))})])):g("",!0),a("div",ta,r(i.detailsDialog.item.number),1),i.detailsDialog.item.flavors&&i.detailsDialog.item.flavors.length>0&&!i.detailsDialog.item.number?(d(),n("div",{key:1,class:"divTypes",onClick:e[9]||(e[9]=t=>l.chooseFlavorClick(i.detailsDialog.item))},"\u9009\u62E9\u89C4\u683C ")):(d(),n("div",ia,[a("img",{src:w,onClick:e[10]||(e[10]=t=>l.addCart(i.detailsDialog.item))})]))])]),a("div",{class:"detailsDialogClose",onClick:e[11]||(e[11]=t=>i.detailsDialog.show=!1)},la)]),_:1},8,["modelValue"])):g("",!0),i.setMealDialog.show?(d(),P(I,{key:2,modelValue:i.setMealDialog.show,"onUpdate:modelValue":e[17]||(e[17]=t=>i.setMealDialog.show=t),"show-confirm-button":!1,class:"setMealDetailsDialog",ref:"setMealDetailsDialogd"},{default:u(()=>[a("div",da,[a("div",ra,r(i.setMealDialog.item.name),1),(d(!0),n(m,null,_(i.setMealDialog.item.list,(t,h)=>(d(),n("div",{class:"item",key:h},[f(C,{src:l.imgPathConvert(t.image)},{default:u(()=>[na]),_:2},1032,["src"]),a("div",ca,[b(r(t.name+"("+t.copies+"\u4EFD)")+" ",1),a("div",va,[ha,a("span",null,r(t.price/100),1)])]),a("div",ga,r(t.description),1)]))),128))]),a("div",ua,[a("div",ma,[_a,a("span",null,r(i.setMealDialog.item.price/100),1)]),a("div",fa,[i.setMealDialog.item.number>0?(d(),n("div",pa,[a("img",{src:y,onClick:e[13]||(e[13]=t=>l.subtractCart(i.setMealDialog.item))})])):g("",!0),a("div",Da,r(i.setMealDialog.item.number),1),i.setMealDialog.item.number?(d(),n("div",Ca,[a("img",{src:w,onClick:e[14]||(e[14]=t=>l.addCart(i.setMealDialog.item))})])):g("",!0),i.setMealDialog.item.number?g("",!0):(d(),n("div",{key:2,class:"addCart",onClick:e[15]||(e[15]=t=>l.addCart(i.setMealDialog.item))},"\u52A0\u5165\u8D2D\u7269\u8F66"))])]),a("div",{class:"detailsDialogClose",onClick:e[16]||(e[16]=t=>i.setMealDialog.show=!1)},ya)]),_:1},8,["modelValue"])):g("",!0)])}const Na=O(Y,[["render",wa],["__scopeId","data-v-ba49230a"]]);export{Na as default};
