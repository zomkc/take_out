import"./axios.7f6bf870.js";import{E as U}from"./el-image-viewer.be72f516.js";import{c as T,a as A,d as V,s as R,b as S,u as M,e as B,i as x,f as q,_ as k}from"./noImg.06919004.js";import{_ as O,aa as N,o as d,j as n,q as t,P as m,ab as _,p as D,l as r,k as g,d as f,w as u,m as P,ac as j,a5 as F,s as b,ad as z,ae as H}from"./index.93b7fa5a.js";import{E as G}from"./index.2e452faa.js";import"./index.cc09d482.js";import"./index.560cc0f0.js";const J=""+new URL("../images/user.png",import.meta.url).href,K=""+new URL("../images/favico.jpg",import.meta.url).href,Q=""+new URL("../images/time.png",import.meta.url).href,W=""+new URL("../images/money.png",import.meta.url).href,X=""+new URL("../images/location.png",import.meta.url).href,y=""+new URL("../images/subtract.png",import.meta.url).href,w=""+new URL("../images/add.png",import.meta.url).href,L=""+new URL("../images/close.png",import.meta.url).href;const Y={components:{ElConfigProvider:G},data(){return{activeType:0,categoryList:[],categoryId:void 0,dishList:[],cartData:[],dialogFlavor:{name:"",flavors:[],dishId:void 0,price:void 0,show:!1,image:""},cartDialogShow:!1,detailsDialog:{show:!1,item:{image:""}},setMealDialog:{show:!1,item:{}}}},computed:{goodsNum(){let s=0;return this.cartData.forEach(a=>{s+=a.number}),s<99?s:"99+"},goodsPrice(){let s=0;return this.cartData.forEach(a=>{s+=a.number*a.amount}),s}},watch:{"dialogFlavor.show"(s){s?document.querySelector(".divCart").style.zIndex=1:document.querySelector(".divCart").style.zIndex=3e3}},mounted(){this.initData()},methods:{initData(){Promise.all([T(),A({})]).then(s=>{s[0].data.code===1?(this.categoryList=s[0].data.data,Array.isArray(s[0].data.data)&&s[0].data.data.length>0&&(this.categoryId=s[0].data.data[0].id,s[0].data.data[0].type===1?this.getDishList():this.getSetmealData())):console.log(s.data.console.error),s[1].data.code===1?this.cartData=s[1].data.data:console.log(s.data.console.error)})},categoryClick(s,a,o){this.activeType=s,this.categoryId=a,o===1?this.getDishList():this.getSetmealData()},async getDishList(){if(!this.categoryId)return;const s=await V({categoryId:this.categoryId,status:1});if(s.data.code===1){let a=s.data.data;const o=this.cartData;a.length>0&&o.length>0&&a.forEach(c=>{o.forEach(i=>{c.id===i.dishId&&(c.number=i.number)})}),this.dishList=a}else console.log(s.data.console.error)},async getSetmealData(){if(!this.categoryId)return;const s=await R({categoryId:this.categoryId,status:1});if(s.data.code===1){let a=s.data.data;const o=this.cartData;a.length>0&&o.length>0&&a.forEach(c=>{o.forEach(i=>{c.id===i.setmealId&&(c.number=i.number)})}),this.dishList=a}else console.log(s.data.console.error)},async getCartData(){const s=await A({});s.data.code===1?this.cartData=s.data.data:console.log(s.data.console.error)},async addCart(s){let a={amount:s.price/100,dishFlavor:s.dishFlavor,dishId:void 0,setmealId:void 0,name:s.name,image:s.image};Array.isArray(s.flavors)?a.dishId=s.id:a.setmealId=s.id;const o=await S(a);o.data.code===1?(this.dishList.forEach(c=>{c.id===s.id&&(c.number=o.data.data.number)}),this.setMealDialog.show&&(s.number=o.data.data.number),this.getCartData()):console.log(o.data.console.error)},async subtractCart(s){let a={dishId:s.id};Array.isArray(s.flavors)||(a={setmealId:s.id});const o=await M(a);o.data.code===1?(this.dishList.forEach(c=>{c.id===s.id&&(c.number=o.data.number===0?void 0:o.data.data.number)}),this.setMealDialog.show&&(s.number=o.data.data.number===0?void 0:o.data.data.number),this.getCartData()):console.log(o.data.console.error)},openCart(){this.cartData.length>0&&(this.cartDialogShow=!0)},async cartNumAdd(s){let a={amount:s.amount,dishFlavor:s.dishFlavor,dishId:s.dishId,setmealId:s.setmealId,name:s.name,image:s.image};const o=await S(a);o.data.code===1?(this.dishList.forEach(c=>{c.id===(s.dishId||s.setmealId)&&(c.number=o.data.data.number)}),console.log(this.dishList),this.getCartData()):console.log(o.data.console.error)},async cartNumberSubtract(s){let a={dishId:s.dishId,setmealId:s.setmealId};const o=await M(a);o.data.code===1?(this.dishList.forEach(c=>{c.id===(s.dishId||s.setmealId)&&(c.number=o.data.data.number===0?void 0:o.data.data.number)}),this.getCartData()):console.log(o.data.console.error)},changeDishList(s){for(let a of this.dishList)a.id===(s.setmealId||s.dishId)&&(a.number=s.number)},async clearCart(){const s=await B();if(s.data.code===1){for(let a of this.dishList)a.number=void 0;this.cartData=[],this.cartDialogShow=!1}else console.log(s.data.console.error)},chooseFlavorClick(s){this.dialogFlavor={name:"",flavors:[],dishId:void 0,price:void 0,show:!1},this.dialogFlavor={name:s.name,flavors:s.flavors,dishId:s.id,price:s.price,show:!0,image:s.image}},flavorClick(s,a){s.dishFlavor=a,this.dialogFlavor.show=!1,this.dialogFlavor.show=!0},dialogFlavorAddCart(){const s=this.dialogFlavor;let a=!0,o=[];s.flavors!=null&&s.flavors.forEach(c=>{c.dishFlavor?o.push(c.dishFlavor):(a=!1,console.log(res.data.console.error))}),a&&(this.addCart({price:s.price,dishFlavor:o.join(","),id:s.dishId,flavors:[],image:s.image,name:s.name}),this.dialogFlavor.show=!1)},imgPathConvert(s){return x(s)},toAddOrderPage(){this.cartData.length>0&&window.requestAnimationFrame(()=>{this.$router.push("/addorder")})},toUserPage(){window.requestAnimationFrame(()=>{this.$router.push("/user")})},async dishDetails(s){if(this.detailsDialog.item={},this.setMealDialog.item={},Array.isArray(s.flavors))this.detailsDialog.item=s,this.detailsDialog.show=!0;else{const a=await q(s.id);a.data.code===1?(this.setMealDialog.item={...s,list:a.data.data},this.setMealDialog.show=!0):console.log(a.data.console.error)}}}},v=s=>(z("data-v-539723fb"),s=s(),H(),s),Z={id:"main",class:"app"},$={class:"divHead"},ss=j('<div class="divTitle" data-v-539723fb><div class="divStatic" data-v-539723fb><img src="'+K+'" class="logo" data-v-539723fb><div class="divDesc" data-v-539723fb><div class="divName" data-v-539723fb>\u53EA\u56E0\u53EA\u56E0</div><div class="divSend" data-v-539723fb><span data-v-539723fb><img src="'+Q+'" data-v-539723fb> \u8DDD\u79BB1.5km</span><span data-v-539723fb><img src="'+W+'" data-v-539723fb> \u914D\u9001\u8D396\u5143</span><span data-v-539723fb><img src="'+X+'" data-v-539723fb> \u9884\u8BA1\u65F6\u957F12min</span></div></div></div><div class="divDesc" data-v-539723fb> \u7B80\u4ECB: \u53EA\u56E0\u53EA\u56E0\u70B8\u9E21\u5E97\u662F\u9E21\u4F60\u592A\u7F8E\u70B9\u9910\u7684\u72EC\u7ACB\u7684\u54C1\u724C\uFF0C\u5B9A\u4F4D\u201C\u5927\u4F17 \u5316\u7684\u7F8E\u98DF\u5916\u9001\u9910\u996E\u201D\uFF0C\u65E8\u4E3A\u987E\u5BA2\u6253\u9020\u4E13\u4E1A\u7F8E\u98DF\u3002 </div></div>',1),ts={class:"divBody"},as={class:"divType"},es=["onClick"],is={class:"divMenu"},os=["onClick"],ls=v(()=>t("div",{slot:"error",class:"image-slot"},[t("img",{src:k})],-1)),ds={class:"divName"},rs={class:"divDesc"},ns={class:"divDesc"},cs={class:"divBottom"},vs=v(()=>t("span",null,"\uFFE5",-1)),hs={class:"divNum"},gs={key:0,class:"divSubtract"},us=["onClick"],ms={class:"divDishNum"},_s=["onClick"],fs={key:2,class:"divAdd"},ps=["onClick"],Ds=v(()=>t("div",{class:"divLayer"},[t("div",{class:"divLayerLeft"}),t("div",{class:"divLayerRight"})],-1)),Cs={key:0,class:"divCart"},bs={class:"divNum"},ys=v(()=>t("span",null,"\uFFE5",-1)),ws=v(()=>t("div",{class:"divPrice"},null,-1)),ks={class:"divContent"},Is={class:"divFlavorTitle"},Fs=["onClick"],Ls={class:"divBottom"},As=v(()=>t("span",{class:"spanMoney"},"\uFFE5",-1)),Ss=v(()=>t("img",{src:L},null,-1)),Ms=[Ss],Ns={class:"divCartTitle"},Ps=v(()=>t("div",{class:"title"},"\u8D2D\u7269\u8F66",-1)),Es=v(()=>t("i",{class:"el-icon-delete"},null,-1)),Us={class:"divCartContent"},Ts=v(()=>t("div",{slot:"error",class:"image-slot"},[t("img",{src:k})],-1)),Vs={class:"divDesc"},Rs={class:"name"},Bs={class:"price"},xs=v(()=>t("span",{class:"spanMoney"},"\uFFE5",-1)),qs={class:"flavor"},Os={class:"divNum"},js={class:"divSubtract"},zs=["onClick"],Hs={class:"divDishNum"},Gs={class:"divAdd"},Js=["onClick"],Ks=v(()=>t("div",{class:"divSplit"},null,-1)),Qs={class:"divContainer"},Ws=v(()=>t("div",{slot:"error",class:"image-slot"},[t("img",{src:k})],-1)),Xs={class:"title"},Ys={class:"content"},Zs={class:"divNum"},$s={class:"left"},st=v(()=>t("span",null,"\uFFE5",-1)),tt={class:"right"},at={key:0,class:"divSubtract"},et={class:"divDishNum"},it={key:2,class:"divAdd"},ot=v(()=>t("img",{src:L},null,-1)),lt=[ot],dt={class:"divContainer"},rt={class:"title"},nt=v(()=>t("div",{slot:"error",class:"image-slot"},[t("img",{src:k})],-1)),ct={class:"divSubTitle"},vt={class:"divPrice"},ht=v(()=>t("span",null,"\uFFE5",-1)),gt={class:"content"},ut={class:"divNum"},mt={class:"left"},_t=v(()=>t("span",null,"\uFFE5",-1)),ft={class:"right"},pt={key:0,class:"divSubtract"},Dt={class:"divDishNum"},Ct={key:1,class:"divAdd"},bt=v(()=>t("img",{src:L},null,-1)),yt=[bt];function wt(s,a,o,c,i,l){const C=U,I=N("van-dialog"),E=N("van-popup");return d(),n("div",Z,[t("div",$,[t("img",{src:J,onClick:a[0]||(a[0]=(...e)=>l.toUserPage&&l.toUserPage(...e))})]),ss,t("div",ts,[t("div",as,[t("ul",null,[(d(!0),n(m,null,_(i.categoryList,(e,h)=>(d(),n("li",{key:h,onClick:p=>l.categoryClick(h,e.id,e.type),class:D({active:i.activeType===h})},r(e.name),11,es))),128))])]),t("div",is,[t("div",null,[(d(!0),n(m,null,_(i.dishList,(e,h)=>(d(),n("div",{class:"divItem",key:h,onClick:p=>l.dishDetails(e)},[f(C,{src:l.imgPathConvert(e.image)},{default:u(()=>[ls]),_:2},1032,["src"]),t("div",null,[t("div",ds,r(e.name),1),t("div",rs,r(e.description),1),t("div",ns,r("\u6708\u9500"+(e.saleNum?e.saleNum:0)),1),t("div",cs,[vs,t("span",null,r(e.price/100),1)]),t("div",hs,[e.number>0?(d(),n("div",gs,[t("img",{src:y,onClick:F(p=>l.subtractCart(e),["prevent","stop"])},null,8,us)])):g("",!0),t("div",ms,r(e.number),1),e.flavors&&e.flavors.length>0&&!e.number?(d(),n("div",{key:1,class:"divTypes",onClick:F(p=>l.chooseFlavorClick(e),["prevent","stop"])},"\u9009\u62E9\u89C4\u683C ",8,_s)):(d(),n("div",fs,[t("img",{src:w,onClick:F(p=>l.addCart(e),["prevent","stop"])},null,8,ps)]))])])],8,os))),128))])])]),Ds,i.categoryList.length>0?(d(),n("div",Cs,[t("div",{class:D({imgCartActive:i.cartData&&i.cartData.length>0,imgCart:!i.cartData||i.cartData.length<1}),onClick:a[1]||(a[1]=(...e)=>l.openCart&&l.openCart(...e))},null,2),i.cartData&&i.cartData.length>0?(d(),n("div",{key:0,class:D({divGoodsNum:!0,moreGoods:i.cartData&&i.cartData.length>99})},r(l.goodsNum),3)):g("",!0),t("div",bs,[ys,t("span",null,r(l.goodsPrice),1)]),ws,t("div",{class:D({btnSubmitActive:i.cartData&&i.cartData.length>0,btnSubmit:!i.cartData||i.cartData.length<1}),onClick:a[2]||(a[2]=(...e)=>l.toAddOrderPage&&l.toAddOrderPage(...e))},"\u53BB\u7ED3\u7B97 ",2)])):g("",!0),f(I,{show:i.dialogFlavor.show,"onUpdate:show":a[5]||(a[5]=e=>i.dialogFlavor.show=e),title:i.dialogFlavor.name,"show-confirm-button":!1,class:"dialogFlavor"},{default:u(()=>[t("div",ks,[(d(!0),n(m,null,_(i.dialogFlavor.flavors,e=>(d(),n("div",{key:e.id},[t("div",Is,r(e.name),1),(d(!0),n(m,null,_(JSON.parse(e.value),h=>(d(),n("span",{key:h,onClick:p=>l.flavorClick(e,h),class:D({spanActive:e.dishFlavor===h})},r(h),11,Fs))),128))]))),128))]),t("div",Ls,[t("div",null,[As,b(r(i.dialogFlavor.price/100),1)]),t("div",{onClick:a[3]||(a[3]=(...e)=>l.dialogFlavorAddCart&&l.dialogFlavorAddCart(...e))},"\u52A0\u5165\u8D2D\u7269\u8F6622")]),t("div",{onClick:a[4]||(a[4]=e=>i.dialogFlavor.show=!1),class:"divFlavorClose"},Ms)]),_:1},8,["show","title"]),f(E,{show:i.cartDialogShow,"onUpdate:show":a[7]||(a[7]=e=>i.cartDialogShow=e),position:"bottom",style:{height:"50%"},class:"dialogCart"},{default:u(()=>[t("div",Ns,[Ps,t("div",{class:"clear",onClick:a[6]||(a[6]=(...e)=>l.clearCart&&l.clearCart(...e))},[Es,b(" \u6E05\u7A7A ")])]),t("div",Us,[(d(!0),n(m,null,_(i.cartData,e=>(d(),n("div",{key:e.id,class:"divCartItem"},[f(C,{src:l.imgPathConvert(e.image)},{default:u(()=>[Ts]),_:2},1032,["src"]),t("div",Vs,[t("div",Rs,r(e.name),1),t("div",Bs,[xs,b(r(e.amount),1)]),t("div",qs,r(e.dishFlavor),1)]),t("div",Os,[t("div",js,[t("img",{src:y,onClick:h=>l.cartNumberSubtract(e)},null,8,zs)]),t("div",Hs,r(e.number),1),t("div",Gs,[t("img",{src:w,onClick:h=>l.cartNumAdd(e)},null,8,Js)])]),Ks]))),128))])]),_:1},8,["show"]),i.detailsDialog.show?(d(),P(I,{key:1,modelValue:i.detailsDialog.show,"onUpdate:modelValue":a[12]||(a[12]=e=>i.detailsDialog.show=e),"show-confirm-button":!1,class:"detailsDialog",ref:"detailsDialog"},{default:u(()=>[t("div",Qs,[f(C,{src:l.imgPathConvert(i.detailsDialog.item.image)},{default:u(()=>[Ws]),_:1},8,["src"]),t("div",Xs,r(i.detailsDialog.item.name),1),t("div",Ys,r(i.detailsDialog.item.description),1)]),t("div",Zs,[t("div",$s,[st,t("span",null,r(i.detailsDialog.item.price/100),1)]),t("div",tt,[i.detailsDialog.item.number>0?(d(),n("div",at,[t("img",{src:y,onClick:a[8]||(a[8]=e=>l.subtractCart(i.detailsDialog.item))})])):g("",!0),t("div",et,r(i.detailsDialog.item.number),1),i.detailsDialog.item.flavors&&i.detailsDialog.item.flavors.length>0&&!i.detailsDialog.item.number?(d(),n("div",{key:1,class:"divTypes",onClick:a[9]||(a[9]=e=>l.chooseFlavorClick(i.detailsDialog.item))},"\u9009\u62E9\u89C4\u683C ")):(d(),n("div",it,[t("img",{src:w,onClick:a[10]||(a[10]=e=>l.addCart(i.detailsDialog.item))})]))])]),t("div",{class:"detailsDialogClose",onClick:a[11]||(a[11]=e=>i.detailsDialog.show=!1)},lt)]),_:1},8,["modelValue"])):g("",!0),i.setMealDialog.show?(d(),P(I,{key:2,modelValue:i.setMealDialog.show,"onUpdate:modelValue":a[17]||(a[17]=e=>i.setMealDialog.show=e),"show-confirm-button":!1,class:"setMealDetailsDialog",ref:"setMealDetailsDialogd"},{default:u(()=>[t("div",dt,[t("div",rt,r(i.setMealDialog.item.name),1),(d(!0),n(m,null,_(i.setMealDialog.item.list,(e,h)=>(d(),n("div",{class:"item",key:h},[f(C,{src:l.imgPathConvert(e.image)},{default:u(()=>[nt]),_:2},1032,["src"]),t("div",ct,[b(r(e.name+"("+e.copies+"\u4EFD)")+" ",1),t("div",vt,[ht,t("span",null,r(e.price/100),1)])]),t("div",gt,r(e.description),1)]))),128))]),t("div",ut,[t("div",mt,[_t,t("span",null,r(i.setMealDialog.item.price/100),1)]),t("div",ft,[i.setMealDialog.item.number>0?(d(),n("div",pt,[t("img",{src:y,onClick:a[13]||(a[13]=e=>l.subtractCart(i.setMealDialog.item))})])):g("",!0),t("div",Dt,r(i.setMealDialog.item.number),1),i.setMealDialog.item.number?(d(),n("div",Ct,[t("img",{src:w,onClick:a[14]||(a[14]=e=>l.addCart(i.setMealDialog.item))})])):g("",!0),i.setMealDialog.item.number?g("",!0):(d(),n("div",{key:2,class:"addCart",onClick:a[15]||(a[15]=e=>l.addCart(i.setMealDialog.item))},"\u52A0\u5165\u8D2D\u7269\u8F66"))])]),t("div",{class:"detailsDialogClose",onClick:a[16]||(a[16]=e=>i.setMealDialog.show=!1)},yt)]),_:1},8,["modelValue"])):g("",!0)])}const Nt=O(Y,[["render",wt],["__scopeId","data-v-539723fb"]]);export{Nt as default};
