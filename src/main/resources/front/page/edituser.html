<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=no,minimal-ui">
    <title>只因只因</title>
    <link rel="icon" href="./../images/favico.ico">
    <!--element-ui的样式-->
    <link rel="stylesheet" href="../../backend/plugins/element-ui/index.css"/>
    <!-- 引入样式  -->
    <link rel="stylesheet" href="../styles/edituser.css"/>
</head>
<body>

    <div id="app" class="app">
        <div id="app2">修改信息</div>
        <el-form label-width="80px" class="form" :model="form">
            <el-form-item label="头像" >
                <div class="uploader">
                    <el-upload
                            action="/common/upload"
                            :show-file-list="false"
                            :on-success="handleAvatarSuccess"
                            :before-upload="beforeAvatarUpload">
                        <img v-if="form.avatar" :src="form.avatar" class="avatar">
                        <i v-else class="el-icon-plus avatar-uploader-icon"></i>
                    </el-upload>
                </div>
            </el-form-item>
            <el-form-item label="手机号">
                <el-input  type="phone" v-model="form.phone"></el-input>
            </el-form-item>
            <el-form-item label="昵称">
                <el-input type="name" v-model="form.name"></el-input>
            </el-form-item>
            <el-form-item label="密码" >
                <el-input type="password" v-model="form.password"></el-input>
            </el-form-item>
            <el-form-item label="性别" >
                <el-radio v-model="form.sex" label="1">男</el-radio>
                <el-radio v-model="form.sex" label="2">女</el-radio>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="submitForm">确认修改</el-button>
                <el-button type="primary" @click="cancelForm">取消</el-button>
            </el-form-item>
        </el-form>
    </div>

    <!-- 开发环境版本，包含了有帮助的命令行警告 -->
    <script src="../../backend/plugins/vue/vue.js"></script>
    <!-- 引入组件库 -->
    <script src="../../backend/plugins/element-ui/index.js"></script>
    <!--不同屏幕尺寸根字体设置-->
    <script src="./../js/base.js"></script>
    <!-- 引入axios -->
    <script src="../../backend/plugins/axios/axios.min.js"></script>
    <script src="./../js/request.js"></script>
    <script src="./../api/order.js"></script>
    <script src="./../api/login.js"></script>
    <script>
        new Vue({
            el: "#app",
            data(){
                return {
                    form: {
                        // phone: '123',//手机号
                        // name: '张三',//姓名
                        // sex: '1',//性别,1男,2女
                        // avatar: '', //头像
                        // password: '123'//密码
                    },
                }
            },
            computed: {},
            created() {
                this.userPhone = sessionStorage.getItem("userPhone")
                this.initData()
            },
            mounted() {

            },
            methods: {
                //初始化用户数据
                async initData() {
                    const res = await edituserApi({phone: this.userPhone})
                    if (res.code === 1) {
                        this.form = res.data
                    } else {
                        this.$notify({type: 'warning', message: res.msg});
                    }
                },
                beforeAvatarUpload(file) {
                    if (file) {
                        const suffix = file.name.split('.')[1]
                        const size = file.size / 1024 / 1024 < 2
                        if (['png', 'jpeg', 'jpg'].indexOf(suffix) < 0) {
                            this.$message.error('上传图片只支持 png、jpeg、jpg 格式！')
                            this.$refs.upload.clearFiles()
                            return false
                        }
                        if (!size) {
                            this.$message.error('上传文件大小不能超过 2MB!')
                            return false
                        }
                        return file
                    }
                },
                //上传成功后返回头像地址
                handleAvatarSuccess(response, file, fileList) {
                    this.form.avatar = `/common/download?name=${response.data}`
                    // alert(this.form.avatar)
                },
                //确认修改
                async submitForm(){
                    const res = await editApi(this.form)
                    if (res.code === 1) {
                        window.requestAnimationFrame(() => {
                            window.location.href = '/front/page/user.html'
                        })
                    }else {
                        this.$notify({type: 'warning', message: res.msg});
                    }
                },
                //取消修改
                cancelForm(){
                    window.requestAnimationFrame(() => {
                        window.location.href = '/front/page/user.html'
                    })
                },
            }
        })

    </script>
</body>
</html>